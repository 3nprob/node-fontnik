// Protocol Version 2

package mapbox.fontnik;

option optimize_for = LITE_RUNTIME;

message Glyph {
    // FreeType glyph index
    required uint32 glyph_index = 1;

    // Unicode codepoint
    optional uint32 codepoint = 2;

    // Glyph metrics
    optional GlyphMetrics metrics = 3;

    // Signed distance field bitmap rendered from glyph outlines.
    optional bytes bitmap = 4;
}

message GlyphMetrics {
    // Encoded as int32_t in Harfbuzz?
    required sint32 x_bearing = 1;
    required sint32 y_bearing = 2;
    required uint32 width = 3;
    required uint32 height = 4;
    required uint32 advance = 5;
}

message Face {
    optional string family_name = 1;
    optional string style_name = 2;

    repeated Glyph glyphs = 3;

    optional FaceMetrics metrics = 4;
}

message FaceMetrics {
    // Encoded as int32_t in Harfbuzz?
    optional double ascender = 1;
    optional double descender = 2;
    optional double line_height = 3;
}

message Font {
    repeated Face faces = 1;
    optional Metadata metadata = 2;
    extensions 16 to 8191;
}

// Signed distance field encoding metadata
message Metadata {
    optional uint32 size = 1;
    optional float scale = 2;

    optional uint32 buffer = 3;
    optional uint32 radius = 4;
    optional float offset = 5;
    optional float cutoff = 6;
    optional uint32 granularity = 7;
}
